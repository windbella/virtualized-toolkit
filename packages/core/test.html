<html>
  <head>
    <style>
      .scroller {
        width: 200px;
        height: 200px;
        overflow: auto;
      }
      .wrapper {
        width: 300px;
      }
      .list {
        margin: 0;
        padding: 0;
      }
      .list li {
        height: 30px;
        list-style-type: none;
      }
    </style>
  </head>
  <body>
    <div class="scroller">
      <div class="wrapper">
        <ul class="list"></ul>
      </div>
    </div>
    <script type="module" src="./dist/index.esm.js"></script>
    <script type="module">
      import {Virtualized} from './dist/index.esm.js';
      const virtualized = new Virtualized();
      const scroller = document.querySelector('.scroller');
      const wrapper = document.querySelector('.wrapper');
      const list = document.querySelector('.list');
      const cache = {
        items: {},
        prevItems: {},
        offset: 0,
      };
      const items = new Array(100)
        .fill()
        .map((_, index) => ({name: `Item ${index + 1}`, index}));
      const onChange = (state) => {
        const {offset, limit, top, scrollHeight} = state;
        const sliceItems = items.slice(offset, offset + limit);
        const prevItems = {};
        const prependItems = [];
        const appendItems = [];
        sliceItems.forEach(({name, index}) => {
          let li;
          if (cache.items[index]) {
            li = cache.items[index];
          } else {
            li = document.createElement('li');
            li.innerHTML = `${name}`;
            cache.items[index] = li;
          }
          if (cache.prevItems[index]) {
            delete cache.prevItems[index];
          } else if (index < cache.offset) {
            prependItems.push(li);
          } else {
            appendItems.push(li);
          }
          prevItems[index] = li;
        });
        list.prepend(...prependItems);
        list.append(...appendItems);
        Object.keys(cache.prevItems).forEach((index) => {
          list.removeChild(cache.prevItems[index]);
        });
        cache.prevItems = prevItems;
        cache.offset = offset;
        wrapper.style.height = `${scrollHeight}px`;
        list.style.transform = `translate(0, ${top}px)`;
      };
      virtualized.bind({
        target: scroller,
        itemSize: 30,
        itemCount: 100,
        throttleTime: 0,
        onChange,
      });
    </script>
  </body>
</html>
